name: PR Check

on:
  pull_request:
    types: [opened, synchronize]
    branches: [main]

jobs:
  test:
    name: Run PR Tests (Non-blocking)
    runs-on: ubuntu-latest
    continue-on-error: true  #í…ŒìŠ¤íŠ¸ ë¬´ì‹œ

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK 21
        uses: actions/setup-java@v3
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Run Gradle Tests
        run: |
          chmod +x ./gradlew
          ./gradlew test || echo "âš ï¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤."

      - name: Print test result status
        if: always()
        run: |
          echo "í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ì›Œí¬í”Œë¡œëŠ” ì„±ê³µí•©ë‹ˆë‹¤."

      - name: Notify Discord
        if: always()
        run: |
          STATUS="âœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ"
          if [ "${{ job.status }}" != "success" ]; then
            STATUS="âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"
          fi

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"username\": \"GitHub Actions\", \"content\": \"ğŸ§ª PR í…ŒìŠ¤íŠ¸ ì™„ë£Œ - $STATUS\nğŸ”— [PR ë³´ê¸°](${{ github.event.pull_request.html_url }})\"}" \
               ${{ secrets.DISCORD_WEBHOOK_URL }}
